@page "/login"
@using System.Net.Http
@using PeopleApp.Client.Services
@using PeopleApp.Client.Services.Auth
@using PeopleApp.Client.Dtos
@inject AuthService AuthService
@inject NavigationManager Navigation

<div class="login-container">
    <h2>Login</h2>

    <input type="email" @bind="email" placeholder="Email" />
    <input type="password" @bind="password" placeholder="Contrase침a" />

    <button @onclick="HandleLogin">Iniciar sesi칩n</button>
    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <p style="color: red;">@errorMessage</p>
    }
</div>

@code {
    private string email = "";
    private string password = "";
    private string errorMessage = "";

    private async Task HandleLogin()
    {
        try
        {
            errorMessage = "";

            // 1) Crear el DTO con las credenciales
            var loginRequest = new LoginRequestDto { Email = email, Password = password };

            // 2) Llamar a AuthService (que autom치ticamente guarda el token)
            await AuthService.LoginAsync(loginRequest);

            // 3) Redirigir al usuario a la p치gina principal
            Navigation.NavigateTo("/");
        }
        catch (Exception ex)
        {
            errorMessage = $"Error en login: {ex.Message}";
            Console.WriteLine(errorMessage);
        }
    }
}

}